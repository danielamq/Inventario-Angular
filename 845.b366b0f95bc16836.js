"use strict";(self.webpackChunkinventory=self.webpackChunkinventory||[]).push([[845],{2845:(lt,Z,i)=>{i.r(Z),i.d(Z,{SalesModule:()=>rt});var m=i(9808),g=i(1083),s=i(3075),C=i(7423),V=i(4449),N=i(2181),b=i(4107),F=i(2638),_=i(5245),v=i(7531),S=i(6087),U=i(4594),h=i(5861),J=i(5226),d=i.n(J),c=i(4999),L=i(4847),p=i(8966);class D{}var T=i(508),M=i(5581),t=i(5e3),y=i(520),P=i(2340);let A=(()=>{class n{constructor(e){this.http=e,this.url=P.N.ApiURL}crearVenta(e){const o=this.url+"venta";return new y.WM({"Content-Type":"application/json"}),this.http.post(o,e)}listarVentas(){return this.http.get(this.url+"venta")}obtenerVentaPorId(e){return this.http.get(`${this.url}venta/${e}`)}eliminarVenta(e){return this.http.delete(`${this.url}venta/${e}`)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(y.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var O=i(3084),w=i(3364),u=i(7322);function E(n,a){if(1&n&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.nombre," ")}}function Y(n,a){if(1&n&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.nombre," ")}}let I=(()=>{class n{constructor(e,o,r,l,f){this.dialogRef=e,this.data=o,this.salesService=r,this.inventoryService=l,this.usersService=f,this.nuevaVenta=new D,this.productos=[],this.distribuidores=[],this.sAccionModal="",this.sAccionModal=0==this.data.accion?"Agregar":"Editar",console.log(this.sAccionModal)}ngOnInit(){this.cargarProductos(),this.cargarDistribuidores(),1===this.data.accion&&this.salesService.obtenerVentaPorId(this.data.nIdVenta).subscribe({next:e=>{this.nuevaVenta=e,e.producto&&e.producto.id&&(this.nuevaVenta.productoId=e.producto.id)},error:e=>{console.error("\u274c Error al cargar la venta:",e),d().fire("Error","No se pudieron cargar los datos de la venta","error")}})}cargarProductos(){this.inventoryService.listarProductos().subscribe({next:e=>{this.productos=e,console.log("\u2705 Productos cargados:",this.productos)},error:e=>console.error("\u274c Error cargando productos:",e)})}cargarDistribuidores(){this.usersService.listarDistribuidores().subscribe({next:e=>{this.distribuidores=e,console.log("\u2705 Distribuidores cargados:",this.productos)},error:e=>console.error("\u274c Error cargando Distribuidores:",e)})}guardarVenta(){var e=this;return(0,h.Z)(function*(){e.nuevaVenta.nombreCliente&&e.nuevaVenta.productoId?0===e.data.accion&&e.salesService.crearVenta(e.nuevaVenta).subscribe({next:()=>{d().fire({title:"Venta creada con \xe9xito",text:"La venta se ha registrado correctamente.",icon:"success",timer:2500,showConfirmButton:!1}),e.fnCerrarModal(1)},error:o=>{console.error("\u274c Error al crear venta:",o),d().fire("Error","No se pudo crear la venta. Intenta nuevamente.","error"),console.log("datso enviados",e.nuevaVenta)}}):d().fire("Error","Debes completar nombre y seleccionar un producto","warning")})()}onDistribuidorChange(e){this.nuevaVenta.esMayorista=null!=e}fnCerrarModal(e){1===e?this.dialogRef.close(e):this.dialogRef.close()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.so),t.Y36(p.WI),t.Y36(A),t.Y36(O.V),t.Y36(w.f))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-sales-form"]],features:[t._Bn([{provide:T._A,useClass:M.B},{provide:T.sG,useValue:M.F}])],decls:38,vars:8,consts:[["mat-dialog-title","",1,"clstitulo"],["autocomplete","off","name","Formulario","id","new-form"],[1,"col-md-12"],[2,"display","initial"],["matInput","","type","text","maxlength","50","autocomplete","nope","name","nombre",3,"ngModel","ngModelChange"],["name","productoId",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["name","distribuidorId",3,"ngModel","ngModelChange","selectionChange"],["matInput","","type","number","autocomplete","nope","name","cantidad",3,"ngModel","ngModelChange"],["matInput","","type","number","autocomplete","nope","name","descuentoAdicional",3,"ngModel","ngModelChange"],[1,"row",2,"padding-top","1rem"],[1,"col-md-6"],["type","button","color","primary","mat-raised-button","",2,"width","100%",3,"click"],["type","button","color","warn","mat-raised-button","",2,"width","100%",3,"click"],[3,"value"]],template:function(e,o){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.qZA(),t.TgZ(3,"form",1)(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),t._uU(7,"Nombre Cliente"),t.qZA(),t.TgZ(8,"input",4),t.NdJ("ngModelChange",function(l){return o.nuevaVenta.nombreCliente=l}),t.qZA()()(),t.TgZ(9,"div",2)(10,"mat-form-field",3)(11,"mat-label"),t._uU(12,"Producto"),t.qZA(),t.TgZ(13,"mat-select",5),t.NdJ("ngModelChange",function(l){return o.nuevaVenta.productoId=l}),t.YNc(14,E,2,2,"mat-option",6),t.qZA()()(),t.TgZ(15,"div",2)(16,"mat-form-field",3)(17,"mat-label"),t._uU(18,"Distribuidor"),t.qZA(),t.TgZ(19,"mat-select",7),t.NdJ("ngModelChange",function(l){return o.nuevaVenta.distribuidorId=l})("selectionChange",function(l){return o.onDistribuidorChange(l.value)}),t.YNc(20,Y,2,2,"mat-option",6),t.qZA()()(),t.TgZ(21,"div",2)(22,"mat-form-field",3)(23,"mat-label"),t._uU(24,"Cantidad"),t.qZA(),t.TgZ(25,"input",8),t.NdJ("ngModelChange",function(l){return o.nuevaVenta.cantidad=l}),t.qZA()()(),t.TgZ(26,"div",2)(27,"mat-form-field",3)(28,"mat-label"),t._uU(29,"Descuento adicional"),t.qZA(),t.TgZ(30,"input",9),t.NdJ("ngModelChange",function(l){return o.nuevaVenta.descuentoAdicional=l}),t.qZA()()(),t.TgZ(31,"div",10)(32,"div",11)(33,"button",12),t.NdJ("click",function(){return o.guardarVenta()}),t._uU(34,"Grabar"),t.qZA()(),t.TgZ(35,"div",11)(36,"button",13),t.NdJ("click",function(){return o.fnCerrarModal(0)}),t._uU(37,"Cancelar"),t.qZA()()()()()),2&e&&(t.xp6(2),t.hij("",o.sAccionModal," Venta"),t.xp6(6),t.Q6J("ngModel",o.nuevaVenta.nombreCliente),t.xp6(5),t.Q6J("ngModel",o.nuevaVenta.productoId),t.xp6(1),t.Q6J("ngForOf",o.productos),t.xp6(5),t.Q6J("ngModel",o.nuevaVenta.distribuidorId),t.xp6(1),t.Q6J("ngForOf",o.distribuidores),t.xp6(5),t.Q6J("ngModel",o.nuevaVenta.cantidad),t.xp6(5),t.Q6J("ngModel",o.nuevaVenta.descuentoAdicional))},directives:[p.uh,s._Y,s.JL,s.F,u.KE,u.hX,v.Nt,s.Fj,s.nD,s.JJ,s.On,b.gD,m.sg,T.ey,s.wV,C.lW],styles:[".clstitulo[_ngcontent-%COMP%]{background-color:#334d6e;color:#fff;text-align:center;border-radius:calc(.25rem - 1px) calc(.25rem - 1px) 0 0;height:3rem;padding-top:.5rem}@media (min-width: 700px){.selectResp[_ngcontent-%COMP%]{bottom:.75rem}.pb-1[_ngcontent-%COMP%]{padding-bottom:1rem!important}}.selectMat[_ngcontent-%COMP%]{display:initial}"]}),n})();var x=i(7238);function Q(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw().fnClearFilter()}),t.TgZ(1,"mat-icon"),t._uU(2,"close"),t.qZA()()}}function B(n,a){1&n&&(t.TgZ(0,"th",28),t._uU(1,"Nombre"),t.qZA())}function R(n,a){if(1&n&&(t.TgZ(0,"td",29),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(e.nombreCliente)}}function q(n,a){1&n&&(t.TgZ(0,"th",28),t._uU(1,"Producto consignado"),t.qZA())}function H(n,a){if(1&n&&(t.TgZ(0,"td",29),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(null==e.producto?null:e.producto.nombre)}}function $(n,a){1&n&&(t.TgZ(0,"th",28),t._uU(1,"Cantidad"),t.qZA())}function G(n,a){if(1&n&&(t.TgZ(0,"td",29),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(e.cantidad)}}function j(n,a){1&n&&(t.TgZ(0,"th",28),t._uU(1,"Precio"),t.qZA())}function z(n,a){if(1&n&&(t.TgZ(0,"td",29),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(t.Dn7(2,1,e.precioUsado,"COP","symbol"))}}function k(n,a){1&n&&(t.TgZ(0,"th",28),t._uU(1,"Fecha registro"),t.qZA())}function X(n,a){if(1&n&&(t.TgZ(0,"td",29),t._uU(1),t.ALo(2,"date"),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.fecha,"dd/MM/yyyy"))}}function W(n,a){1&n&&(t.TgZ(0,"th",30),t._uU(1,"Acciones"),t.qZA())}function K(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"td",29)(1,"button",31),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().fnFormModal(1,l.id)}),t.TgZ(2,"mat-icon"),t._uU(3,"edit"),t.qZA()(),t.TgZ(4,"button",32),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().fnEliminarVenta(l.id)}),t.TgZ(5,"mat-icon"),t._uU(6,"delete"),t.qZA()()()}}function tt(n,a){1&n&&t._UZ(0,"tr",33)}function et(n,a){1&n&&t._UZ(0,"tr",34)}const nt=function(){return[10,25,100]},ot=[{path:"",component:(()=>{class n{constructor(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-sales"]],decls:1,vars:0,template:function(e,o){1&e&&t._UZ(0,"router-outlet")},directives:[g.lC],encapsulation:2}),n})(),children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:(()=>{class n{constructor(e,o){this.salesService=e,this.dialog=o,this.appName="Gesti\xf3n de Ventas",this.txtFiltro=new s.NI(""),this.displayedColumns=["nombreCliente","producto","cantidad","precioUsado","fecha","acciones"],this.dataSource=new c.by,this.dataSource=new c.by,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}ngOnInit(){this.listarVentas()}fnClearFilter(){var e=this;return(0,h.Z)(function*(){e.dataSource&&(e.dataSource.filter="")})()}applyFilter(e){this.dataSource.filter=e.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}listarVentas(){this.salesService.listarVentas().subscribe({next:e=>{this.dataSource.data=e,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,console.log("ventas",this.dataSource.data)},error:e=>{console.error("\u274c Error al listar Ventas",e),d().fire("Error","No se pudieron cargar los Ventas","error")}})}fnFormModal(e,o){var r=this;return(0,h.Z)(function*(){r.accionActual=e,r.dialog.open(I,{width:"50rem",disableClose:!0,data:{accion:e,nIdVenta:o}}).afterClosed().subscribe(f=>{void 0!==f&&r.listarVentas()})})()}fnEliminarVenta(e){var o=this;return(0,h.Z)(function*(){!(yield d().fire({title:"\xbfEst\xe1 seguro?",text:"Esta acci\xf3n eliminar\xe1 la venta de forma permanente.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed||o.salesService.eliminarVenta(e).subscribe({next:()=>{d().fire({title:"venta eliminada",text:"La venta ha sido eliminado correctamente.",icon:"success",timer:2500,showConfirmButton:!1}),o.listarVentas()},error:l=>{console.error("\u274c Error al eliminar la venta:",l),d().fire({title:"Error",text:"No se pudo eliminar la venta. Intenta nuevamente.",icon:"error",confirmButtonText:"Aceptar"})}})})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(A),t.Y36(p.uw))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-sales-list"]],viewQuery:function(e,o){if(1&e&&(t.Gf(S.NW,5),t.Gf(L.YE,5)),2&e){let r;t.iGM(r=t.CRH())&&(o.paginator=r.first),t.iGM(r=t.CRH())&&(o.sort=r.first)}},decls:40,vars:8,consts:[[1,"nav-container-general"],[1,"header-app"],[2,"font-weight","bold"],[1,"fab-container"],["matTooltipPosition","left","mat-raised-button","","mat-mini-fab","","color","primary","matTooltip","Agregar Distribuidor",1,"fab-secondary",3,"click"],[1,"material-icons"],[1,"form","row"],[1,"col-md-10"],["appearance","standard",2,"width","80%"],["matInput","",3,"formControl","keyup"],["input",""],["style","outline: none;","mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],["id","listaMobile",1,"mat-elevation-z8"],[1,"example-container"],["mat-table","","matSort","","aria-describedby","TablaProducto",2,"width","100%",3,"dataSource"],["matColumnDef","nombreCliente"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","producto"],["matColumnDef","cantidad"],["matColumnDef","precioUsado"],["matColumnDef","fecha"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"pageSizeOptions"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",2,"outline","none",3,"click"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","primary","matTooltip","Editar Venta",3,"click"],["color","warn","mat-icon-button","","matTooltip","Eliminar Venta",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3),t.qZA()(),t.TgZ(4,"div",3)(5,"button",4),t.NdJ("click",function(){return o.fnFormModal(0,0)}),t.TgZ(6,"span",5),t._uU(7,"add"),t.qZA()()(),t.TgZ(8,"div",6)(9,"div",7)(10,"mat-form-field",8)(11,"mat-label"),t._uU(12,"Buscar Cliente"),t.qZA(),t.TgZ(13,"input",9,10),t.NdJ("keyup",function(l){return o.applyFilter(l)}),t.qZA(),t.YNc(15,Q,3,0,"button",11),t.qZA()()(),t.TgZ(16,"div",12)(17,"div",13)(18,"table",14),t.ynx(19,15),t.YNc(20,B,2,0,"th",16),t.YNc(21,R,2,1,"td",17),t.BQk(),t.ynx(22,18),t.YNc(23,q,2,0,"th",16),t.YNc(24,H,2,1,"td",17),t.BQk(),t.ynx(25,19),t.YNc(26,$,2,0,"th",16),t.YNc(27,G,2,1,"td",17),t.BQk(),t.ynx(28,20),t.YNc(29,j,2,0,"th",16),t.YNc(30,z,3,5,"td",17),t.BQk(),t.ynx(31,21),t.YNc(32,k,2,0,"th",16),t.YNc(33,X,3,4,"td",17),t.BQk(),t.ynx(34,22),t.YNc(35,W,2,0,"th",23),t.YNc(36,K,7,0,"td",17),t.BQk(),t.YNc(37,tt,1,0,"tr",24),t.YNc(38,et,1,0,"tr",25),t.qZA(),t._UZ(39,"mat-paginator",26),t.qZA()()()),2&e&&(t.xp6(3),t.Oqu(o.appName),t.xp6(10),t.Q6J("formControl",o.txtFiltro),t.xp6(2),t.Q6J("ngIf",o.txtFiltro.value),t.xp6(3),t.Q6J("dataSource",o.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",o.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",t.DdM(7,nt)))},directives:[C.lW,x.gM,u.KE,u.hX,v.Nt,s.Fj,s.JJ,s.oH,m.O5,u.R9,_.Hw,c.BZ,c.w1,c.fO,c.ge,c.Dz,c.ev,c.as,c.XQ,c.nj,c.Gk,S.NW],pipes:[m.H9,m.uU],styles:["table[_ngcontent-%COMP%]{width:100%}.header-app[_ngcontent-%COMP%]{text-align:center;margin-top:1rem}h1[_ngcontent-%COMP%]{margin-bottom:0}.example-container[_ngcontent-%COMP%]{width:100%;overflow:auto}.clsColumnaNombre[_ngcontent-%COMP%]{width:20%}.clsColumnaDescripcion[_ngcontent-%COMP%]{width:35%}.clsColumnaStock[_ngcontent-%COMP%]{width:15%}.clsColumnaAccion[_ngcontent-%COMP%]{width:20%}"]}),n})(),data:{route:"sales/list"}}]}];let at=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[g.Bz.forChild(ot)],g.Bz]}),n})();var it=i(6856);let rt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[m.ez,at,V.ie,N.Tx,b.LD,F.SJ,s.u5,s.UX,_.Ps,v.c,S.TU,U.g0,C.ot,u.lN,c.p0,p.Is,it.FA,x.AV],g.Bz]}),n})()}}]);