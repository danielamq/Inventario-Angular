<div class="sales-form-container">

  <!-- CONTENIDO SCROLLEABLE -->
  <div class="scroll-content" style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">

    <!-- TÍTULO -->
    <h2>{{ sAccionModal }} Venta</h2>

    <!-- CLIENTE -->
    <div class="row mb-3">
      <div class="col-md-12">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Nombre del cliente</mat-label>
          <input matInput [(ngModel)]="nuevaVenta.nombreCliente" />
        </mat-form-field>
      </div>
    </div>

    <!-- SECCIÓN PARA AGREGAR PRODUCTOS -->
    <div class="card p-3 mb-3 shadow-sm">
      <h4 class="mb-3">Agregar productos</h4>

      <div class="row">

        <!-- Producto -->
        <div class="col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Producto</mat-label>
            <mat-select [(ngModel)]="selectedProductoId">
              <mat-option *ngFor="let p of productos" [value]="p.id">
                {{ p.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Cantidad -->
        <div class="col-md-2">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Cantidad</mat-label>
            <input matInput type="number" [(ngModel)]="selectedCantidad" />
          </mat-form-field>
        </div>

        <!-- Descuento -->
        <div class="col-md-2">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Descuento adicional</mat-label>
            <input matInput type="number" [(ngModel)]="selectedDescuento" />
          </mat-form-field>
        </div>

        <!-- Distribuidor -->
        <div class="col-md-3" *ngIf="distribuidorFijo === null">
        <mat-form-field appearance="outline" class="w-100">
            <mat-label>Distribuidor (Opcional)</mat-label>
            <mat-select [(ngModel)]="nuevaVenta.distribuidorId">
            <mat-option [value]="undefined">Sin distribuidor</mat-option>
            <mat-option *ngFor="let d of distribuidores" [value]="d.id">
                {{ d.nombre }}
            </mat-option>
            </mat-select>
        </mat-form-field>
        </div>

        <!-- Botón agregar -->
        <div class="col-md-2 d-flex align-items-center">
          <button mat-raised-button color="primary" class="w-100" (click)="agregarProducto()">
            Agregar
          </button>
        </div>

      </div>
    </div>

    <!-- LISTA DE PRODUCTOS AGREGADOS -->
    <div class="card p-3 shadow-sm" *ngIf="listaProductosVenta.length > 0">
      <h4 class="mb-3">Productos agregados</h4>

      <table class="table table-striped">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Distribuidor</th>
            <th>Mayorista</th>
            <th>Descuento</th>
            <th>Subtotal</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of listaProductosVenta; let i = index">
            <td>{{ getNombreProducto(item.productoId) }}</td>
            <td>{{ item.cantidad }}</td>
            <td>{{ getNombreDistribuidor(item.distribuidorId) }}</td>
            <td>{{ item.esMayorista ? 'Sí' : 'No' }}</td>
            <td>{{ item.descuentoAdicional ?? 0 }}</td>
            <td>{{ item.subtotal ?? 0 }}</td>
            <td class="text-end">
              <button mat-icon-button color="warn" (click)="eliminarProducto(i)">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </tr>
        </tbody>
        <div class="mt-3 text-end" *ngIf="listaProductosVenta.length > 0">
  <strong>Total: ${{ getTotalVenta() | number:'1.2-2' }}</strong>
</div>
      </table>
    </div>

  </div>

  <!-- BOTONES FIJOS -->
  <div class="footer-buttons">
    <button mat-button (click)="fnCerrarModal(0)">Cancelar</button>
    <button mat-raised-button color="accent" (click)="guardarVenta()">Guardar</button>
  </div>

</div>
